- if current_user
  - if params[:username] && (params[:username] != current_user.name)
    %h3.sidebar
      = @user.name
      - if current_user.followed.include?(@user)
        %span.follow
          = link_to "unfollow", :controller => :users, :action => :follow, :id => @user.id, :method => :delete
      - else
        %span.follow
          = link_to("follow", :controller => :users, :action => :follow, :id => @user.id, :method => :post)
    
    %h4.sidebar
      = "Following (#{@user.followed.count})"
    = render "application/follows", :user => @user, :kind => "followed"
    
    %h4.sidebar
      = "Followed by (#{@user.followers.count})"
    = render "application/follows", :user => @user, :kind => "followers"
      
    %h4.sidebar
      Groups
    %hr

  %h3.sidebar
    You
  %h4.sidebar
    Your bookmarks
    = " (#{current_user.bookmarks.size.to_s})"
  
  %div.last_posts
    - current_user.last_posts(3).each do |post|
      %div.last_post
        = link_to post.title, post.link.short_url
        %span.date
          = post.date_to_s
        %span.post_tags
          - if post.tags.size > 0
            - post.tags.each do |tag|
              = link_to tag, :controller => "posts", :action => "index", :tag => tag.name, :username => post.user.name
    %div.last_post_more
      = link_to "more", posts_path

    %h4.sidebar
      = "Following (#{current_user.followed.count})"
    = render "application/follows", :user => current_user, :kind => "followed"

    %h4.sidebar
      = "Followed by (#{current_user.followers.count})"
    = render "application/follows", :user => current_user, :kind => "followers"

  %h4.sidebar
    Groups
- if current_user
  %hr
%div
  - if @tags
    %h3.sidebar Tags
    .tags
      - cache(:action => 'index', :action_suffix => "all_tags", :expires_in => 30.minute) do
        - tag_cloud_limited(@tags, %w(tag_css1 tag_css2 tag_css3 tag_css4), 20) do |tag, css_class|
          = link_to tag.name, { :controller => "posts", :action => "index", :tag => tag.name, :all_users => true }, :class => css_class